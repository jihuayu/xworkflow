# Advanced: Complex chaining of list operations.
# File: Workflow DSL definition

version = "0.1.0"
[[nodes]]
id = "start"

[nodes.data]
type = "start"
title = "Start"
[[nodes.data.variables]]
variable = "numbers"
label = "Numbers"
type = "array[number]"
required = true

[[nodes]]
id = "filter1"

[nodes.data]
type = "list-operation"
title = "Filter Positive"
variable = "numbers"
value_selector = [ "start", "numbers",]
operation = "filter"
filter_by = { key = "value", expression = { comparison_operator = "greater_than", value = 0 } }

[[nodes]]
id = "map1"

[nodes.data]
type = "list-operation"
title = "Square Values"
variable = "squared"
value_selector = [ "filter1", "numbers",]
operation = "map"
map_expression = "{{ item * item }}"

[[nodes]]
id = "sort1"

[nodes.data]
type = "list-operation"
title = "Sort Descending"
variable = "sorted"
value_selector = [ "map1", "squared",]
operation = "sort"
sort_order = "desc"

[[nodes]]
id = "slice1"

[nodes.data]
type = "list-operation"
title = "Take Top 3"
variable = "top"
value_selector = [ "sort1", "sorted",]
operation = "slice"
start_index = 0
end_index = 3

[[nodes]]
id = "reduce1"

[nodes.data]
type = "list-operation"
title = "Sum"
variable = "sum"
value_selector = [ "slice1", "top",]
operation = "reduce"
reduce_expression = "{{ accumulator + item }}"
initial_value = 0

[[nodes]]
id = "end"

[nodes.data]
type = "end"
title = "End"
[[nodes.data.outputs]]
variable = "result"
value_selector = [ "reduce1", "sum",]

[[edges]]
source = "start"
target = "filter1"

[[edges]]
source = "filter1"
target = "map1"

[[edges]]
source = "map1"
target = "sort1"

[[edges]]
source = "sort1"
target = "slice1"

[[edges]]
source = "slice1"
target = "reduce1"

[[edges]]
source = "reduce1"
target = "end"
